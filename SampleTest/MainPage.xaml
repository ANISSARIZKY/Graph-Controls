<Page
    x:Class="SampleTest.MainPage"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:local="using:SampleTest"
    xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
    xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
    xmlns:wgt="using:Microsoft.Toolkit.Graph.Controls"
    xmlns:graph="using:Microsoft.Graph"
    xmlns:Interactivity="using:Microsoft.Xaml.Interactivity"
    xmlns:providers="using:Microsoft.Toolkit.Graph.Providers"
    xmlns:controls="using:Microsoft.Toolkit.Uwp.UI.Controls"
    xmlns:converters="using:Microsoft.Toolkit.Graph.Controls.Converters"
    mc:Ignorable="d"
    Background="{ThemeResource ApplicationPageBackgroundThemeBrush}"
    xmlns:controlsKeepThis="using:Microsoft.Toolkit.Uwp.UI.Controls"><!-- Workaround for https://github.com/microsoft/microsoft-ui-xaml/issues/1286 -->
    <Page.Resources>
        <converters:OneDriveThumbnailConverter x:Key="OneDriveThumbnailConverter"/>
        <converters:FileSizeConverter x:Key="FileSizeConverter"/>
    </Page.Resources>
    <!-- 
        Initialize Graph Provider On Page Load 
    
        Register Client Id: https://docs.microsoft.com/en-us/azure/active-directory/develop/quickstart-register-app
        
        After finishing the initial registration page, you will also need to add an additional redirect URI. 
        Click on "Add a Redirect URI" and check the https://login.microsoftonline.com/common/oauth2/nativeclient checkbox on that page. Then click "Save".
    -->
    <Interactivity:Interaction.Behaviors>
        <!--<providers:InteractiveProviderBehavior ClientId="YOUR_CLIENT_ID_HERE" Scopes="User.Read,User.ReadBasic.All,People.Read,Calendars.Read"/>-->
        <providers:MockProviderBehavior/>
    </Interactivity:Interaction.Behaviors>

    <Grid>
        <wgt:LoginButton VerticalAlignment="Top" HorizontalAlignment="Right"/>
        <ScrollViewer Margin="16,48,16,16">
            <StackPanel>
                <wgt:PeoplePicker x:Name="PeopleChooser"/>
                <TextBlock Margin="0,8,0,0" FontWeight="Bold">Picked People:</TextBlock>
                <ItemsControl ItemsSource="{x:Bind PeopleChooser.ItemsSource}"
                              Margin="8,0,0,0">
                    <ItemsControl.ItemTemplate>
                        <DataTemplate x:DataType="graph:Person">
                            <TextBlock Text="{x:Bind DisplayName}"/>
                        </DataTemplate>
                    </ItemsControl.ItemTemplate>
                </ItemsControl>
                <!-- Use GraphPresenter to make call to OneDrive Recent Filelist -->
                <TextBlock Margin="0,8,0,8" FontWeight="Bold">Recent Files:</TextBlock>
                <wgt:GraphPresenter RequestBuilder="{x:Bind providers:ProviderManager.Instance.GlobalProvider.Graph.Me.Drive.Recent(), Mode=OneWay}"
                                    ResponseType="graph:DriveItem"
                                    IsCollection="True">
                    <wgt:GraphPresenter.ContentTemplate>
                        <DataTemplate>
                            <!-- Return result is a collection of DriveItem's as we used 'IsCollection', so bind that first. -->
                            <ScrollViewer HorizontalScrollMode="Disabled" VerticalScrollBarVisibility="Auto">
                                <ItemsControl ItemsSource="{Binding}">
                                    <ItemsControl.ItemTemplate>
                                        <DataTemplate x:DataType="graph:DriveItem">
                                            <StackPanel>
                                                <controls:ImageEx DataContext="{x:Bind RemoteItem, Converter={StaticResource OneDriveThumbnailConverter}}"
                                                                  PlaceholderSource="/Assets/FileIcon.png"
                                                                  Source="{Binding Result.Medium.Url}" Width="176" Height="176"/>
                                                <TextBlock Text="{Binding Name}"/>
                                                <TextBlock Text="{Binding Size, Converter={StaticResource FileSizeConverter}}"/>
                                            </StackPanel>
                                        </DataTemplate>
                                    </ItemsControl.ItemTemplate>
                                    <ItemsControl.ItemsPanel>
                                        <ItemsPanelTemplate>
                                            <controls:UniformGrid Columns="2" ColumnSpacing="8"/>
                                        </ItemsPanelTemplate>
                                    </ItemsControl.ItemsPanel>
                                </ItemsControl>
                            </ScrollViewer>
                        </DataTemplate>
                    </wgt:GraphPresenter.ContentTemplate>
                </wgt:GraphPresenter>
            </StackPanel>
        </ScrollViewer>
    </Grid>
</Page>
