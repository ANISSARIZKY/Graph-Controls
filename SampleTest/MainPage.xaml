<Page
    x:Class="SampleTest.MainPage"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
    xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
    xmlns:local="using:SampleTest"
    xmlns:wgt="using:Microsoft.Toolkit.Graph.Controls"
    xmlns:graph="using:Microsoft.Graph"
    xmlns:global="using:System.Globalization"
    xmlns:Interactivity="using:Microsoft.Xaml.Interactivity"
    xmlns:providers="using:Microsoft.Toolkit.Graph.Providers"
    xmlns:controls="using:Microsoft.Toolkit.Uwp.UI.Controls"
    xmlns:converters="using:Microsoft.Toolkit.Graph.Controls.Converters"
    mc:Ignorable="d"
    Background="{ThemeResource ApplicationPageBackgroundThemeBrush}"
    xmlns:controlsKeepThis="using:Microsoft.Toolkit.Uwp.UI.Controls"><!-- Workaround for https://github.com/microsoft/microsoft-ui-xaml/issues/1286 -->
    <Page.Resources>
        <converters:OneDriveThumbnailConverter x:Key="OneDriveThumbnailConverter"/>
        <converters:FileSizeConverter x:Key="FileSizeConverter"/>
    </Page.Resources>
    <!-- 
        Initialize Graph Provider On Page Load 
    
        Register Client Id: https://docs.microsoft.com/en-us/azure/active-directory/develop/quickstart-register-app
        
        After finishing the initial registration page, you will also need to add an additional redirect URI. 
        Click on "Add a Redirect URI" and check the https://login.microsoftonline.com/common/oauth2/nativeclient checkbox on that page. Then click "Save".
    -->
    <Interactivity:Interaction.Behaviors>
        <!--<providers:InteractiveProviderBehavior ClientId="YOUR_CLIENT_ID_HERE" Scopes="User.Read,User.ReadBasic.All,People.Read,Calendars.Read"/>-->
        <providers:MockProviderBehavior/>
    </Interactivity:Interaction.Behaviors>

    <Grid>
        <wgt:LoginButton VerticalAlignment="Top" HorizontalAlignment="Right"/>
        <ScrollViewer Margin="16,48,16,16">
            <StackPanel>
                <wgt:PeoplePicker x:Name="PeopleChooser"/>
                <TextBlock Margin="0,8,0,0" FontWeight="Bold">Picked People:</TextBlock>
                <ItemsControl ItemsSource="{x:Bind PeopleChooser.ItemsSource}"
                              Margin="8,0,0,0">
                    <ItemsControl.ItemTemplate>
                        <DataTemplate x:DataType="graph:Person">
                            <TextBlock Text="{x:Bind DisplayName}"/>
                        </DataTemplate>
                    </ItemsControl.ItemTemplate>
                </ItemsControl>
                <!-- Use GraphPresenter to make call to OneDrive Recent Filelist -->
                <TextBlock Margin="0,8,0,8" FontWeight="Bold">Recent Files:</TextBlock>
                <wgt:GraphPresenter RequestBuilder="{x:Bind providers:ProviderManager.Instance.GlobalProvider.Graph.Me.CalendarView, Mode=OneWay}"
                                    ResponseType="graph:Event"
                                    IsCollection="True">
                    <wgt:GraphPresenter.QueryOptions>
                        <!-- Need to create separate Properties as multiple functions not supported in x:Bind see https://github.com/microsoft/microsoft-ui-xaml/issues/2407 -->
                        <wgt:QueryOption Name="startDateTime" Value="{x:Bind Today.ToString('o', global:CultureInfo.InvariantCulture)}"/>
                        <wgt:QueryOption Name="endDateTime" Value="{x:Bind ThreeDaysFromNow.ToString('o', global:CultureInfo.InvariantCulture)}"/>
                    </wgt:GraphPresenter.QueryOptions>
                    <wgt:GraphPresenter.ContentTemplate>
                        <DataTemplate>
                            <!-- Return result is a collection of Event's as we used 'IsCollection', so bind that first. -->
                            <ScrollViewer HorizontalScrollMode="Disabled" VerticalScrollBarVisibility="Auto">
                                <ItemsControl ItemsSource="{Binding}">
                                    <ItemsControl.ItemTemplate>
                                        <DataTemplate x:DataType="graph:Event">
                                            <StackPanel>
                                                <TextBlock FontWeight="Bold">
                                                    <Run Text="{x:Bind local:MainPage.ToLocalTime(Start), Mode=OneWay}"/>
                                                    <Run> - </Run>
                                                    <Run Text="{x:Bind local:MainPage.ToLocalTime(End), Mode=OneWay}"/>
                                                </TextBlock>
                                                <TextBlock Text="{Binding Subject}" Style="{StaticResource TitleTextBlockStyle}"/>
                                                <TextBlock>
                                                    <Run FontFamily="Segoe MDL2 Assets" Text="&amp;#xE707"/>
                                                    <Run> </Run>
                                                    <Run Text="{x:Bind Location.DisplayName, Mode=OneWay}"/>
                                                </TextBlock>
                                            </StackPanel>
                                        </DataTemplate>
                                    </ItemsControl.ItemTemplate>
                                </ItemsControl>
                            </ScrollViewer>
                        </DataTemplate>
                    </wgt:GraphPresenter.ContentTemplate>
                </wgt:GraphPresenter>
            </StackPanel>
        </ScrollViewer>
    </Grid>
</Page>
